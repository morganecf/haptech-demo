<!doctype html>
<html>
  <head>
    <title> Chipmunk Hello World </title>
  
  <script src="paper-js/dist/paper-full.min.js"></script>
  <script src="node_modules/chipmunk/cp.min.js"></script>
  <script src="socket.io.js"></script>

  <script type="text/paperscript" canvas="canvas"> 

          // The socket client 
          var socket = io();

          // CONSTANTS 
          var width = window.innerWidth-30;
          var height = window.innerHeight-30;

          // alert(height);
          // alert(width);

          // Make sure the points correspond to CP points 
          var ground_start = new Point(0, height);
          var ground_end = new Point(width, height);
          var circle_start = new Point(width / 2, 20);
          var circle_radius = 10;
          var user_start = new Point(width / 3, 20);
          var user_radius = 20;

          // Create the ground 
          var ground = new Path();
          ground.strokeColor = 'black';
          ground.add(ground_start, ground_end);

          // Create the circle
          var circle = new Path.Circle(circle_start, circle_radius);
          circle.fillColor = {
            hue: 60,
            saturation: 1,
            brightness: 1
          };
          circle.strokeColor = 'black';
          circle.strokeWidth = 3;
          circle.opacity = 0.7;

          // Create the user 
          var user = new Path.Circle(user_start, user_radius);
          user.fillColor = {
            hue: 320,
            saturation: 1,
            brightness: 1
          };
          user.strokeColor = 'black';
          user.strokeWidth = 5;
          user.opacity = 0.7;

          // Tell the backend we are ready to start the simulation
          // and pass any data the simulation might need  
          socket.emit('ready', {height: height, width: width}); 

          // Listen for draw events 
          socket.on('draw', function (pos) {
            var c = new Path.Circle(pos, 5);
            c.fillColor = 'black';

            circle.position.x = pos.x; 
            circle.position.y = pos.y;
            view.draw();
          }); 

          // Listen for user draw events 
          socket.on('user-move-backend', function (pos) {
            user.position.x = pos.x;
            user.position.y = pos.y;

            view.draw();
          });
      
  </script>

  </head>

  <body>   
      <canvas id="canvas" width="1000" height="1400" keepalive="true"></canvas>
  </body>

  </html>
